# Компилятор языка MiniJava

Ветка `master` соответствует актуальной версии проекта 
и последнему чекпоинту. 

Код старых чекпоинтов в отрыве от остальных частей проекта 
можно посмотреть в соответствующих ветках.

---

## Установка пререквизитов

Вариант для пакетного менеджера **Ubuntu**:

```shell
sudo apt-get install arm-linux-gnueabihf qemu-user-static
```

--- 

## Пример работы

### **Сборка компилятора**

```shell
mkdir -p Compiler/build
cd Compiler/build
cmake ..
make
```

### **Запуск компилятора**

```shell
./Compiler --src ../examples/<example>
```

В результате в текущей директории *build* генерируются 
промежуточные файлы компиляции и ассемблерный код.

### **Запуск ассемблерного кода (с кросс-компилятором ARM)**

```shell
arm-linux-gnueabihf-gcc -static final_program.s -o final_program
./final_program
```

---

## Описание структуры и этапов работы компилятора

### [Грамматика языка](Compiler/Grammar)

Правила грамматики описаны в файле `parser.y`.
Возможные токены - в файле `scanner.l`.

Во время компиляции для проверки корректности написанного кода 
и сбора статистики строится абстрактное синтаксическое дерево (`AST`), в 
котором каждая вершина соответствует терминальному или 
нетерминальному символу грамматики.

В частности, оформлены в виде классов и специализированы:
- `Declaration` (объявление)
- `Expression` (выражение)
- `Statement` (высказывание)
- `NamedEntity` (именованная сущность, она же lvalue)
- `Type` (тип)

`Service` - более абстрактные классы для связи текста программы 
воедино.

Лексический анализатор строится с помощью 
[Flex](https://linux.die.net/man/1/flex), синтаксический - с помощью 
[GNU Bison](https://www.gnu.org/software/bison/).

С полученным на первом этапе работы компилятора `AST` взаимодействуют несколько визиторов различного назначения: `PrintVisitor`, `SymbolTreeVisitor`, `MethodCallVisitor`, `TypeVisitor` и `IRTreeBuildVisitor`. Они используются для отладки, сбора статистики, проверки типов, моделирования стековых фреймов для функций и построения дерева промежуточного представления.

### [Таблицы символов](Compiler/SymbolTable)

...

### [Проверка типов](Compiler/MemberType)

...

### [Механизмы вызовов функций](Compiler/MethodMechanisms)

...

### [Дерево промежуточного представления (IR Tree)](Compiler/IRTree)

...

### [Блоки IR-дерева](Compiler/IRTree/Blocks) 

...

### [Генерация кода (перевод в ассемблер)](Compiler/IRTree/Visitors/CodeGenerationVisitor.h)

...

### [Аллокация регистров](Compiler/IRTree/Instructions)

...

---

## Использованные учебные материалы

- Лекции и семинары по курсу **"Языки программирования и теории компиляции"** в 4 семестре на Факультете Инноваций и Высоких Технологий МФТИ (в составе ФПМИ МФТИ)
    
    Лектор — [@akhtyamovpavel](https://github.com/akhtyamovpavel) 

- Andrew W. Appel, **Modern Compiler Implementation in Java**, Cambridge University Press

---

## Направления дальнейшего развития проекта

- [] Сделать поддержку процессоров с *CISC-архитектурой* (генерация кода **x86-64 Assembly**) 
- [] Проверить отсутствие утечек памяти
- [] Попробовать разрешить часть Shift/Reduce конфликтов грамматики
- [] Сделать подсветку синтаксиса для популярного редактора кода